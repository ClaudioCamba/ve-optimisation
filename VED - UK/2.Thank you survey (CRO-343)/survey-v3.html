
<style>
    /* CSS Amendments ========================================================================== */

    /* All */

    .dy-modal-container .dy-modal-backdrop {
    	opacity: 0.8!important;
    }
    .dy-modal-container .dy-modal-wrapper .dy-modal-contents .dy-lb-close {
    	top: 10px!important;
    	right: 10px!important;
    	cursor: pointer!important;
    	height: 22px!important;
    	width: 22px!important;
    	background: url(data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgNTUgNTUiIGVuYWJsZS1iYWNrZ3JvdW5kPSJuZXcgMCAwIDU1IDU1IiB4bWw6c3BhY2U9InByZXNlcnZlIj48ZyBpZD0iY2xvc2UiPjxwb2x5Z29uIGZpbGw9IiNGRkZGRkYiIHBvaW50cz0iNDMuNSwxNC43IDQwLjMsMTEuNSAyNy41LDI0LjMgMTQuNywxMS41IDExLjUsMTQuNyAyNC4zLDI3LjUgMTEuNSw0MC4zIDE0LjcsNDMuNSAyNy41LDMwLjcgNDAuMyw0My41IDQzLjUsNDAuMyAzMC43LDI3LjUgIi8+PC9nPjwvc3ZnPg==) #1f2025;
    	background-size: 22px!important;
    	border: none!important;
    	border-radius: 0!important;
    }
    .small-txt {
    	font-size: 16px;
    	color: #3e4f58;
    }
    .ved343-main {
        height: auto!important;
        min-height: 400px;
    }
    /* Top */

    .tysurvey-top {
    	width: 100%;
    	height: 75px;
    	padding: 10px;
    	background-color: #e10a0a;
    	display: flex;
    	justify-content: center;
    	align-items: center;
    	border-bottom: 2px solid #B80000;
    }
    .tysurvey-top .pzn-ved-logo {
    	width: auto;
    	height: 100%;
    	display: block;
    	margin: 0 auto;
    }

    /* Body */
    .ved343-content {
    	width: 100%;
    	padding: 24px;
    	height: auto;
        min-height: 325px;
    }
    .ved343-content>.step1, 
    .ved343-content>.step2,
    .ved343-content>.step3 {
    	display: none;
    }
    .ved343-content.step1>.step1,
    .ved343-content.step2>.step2,
    .ved343-content.step3>.step3 {
    	display: block;
    }
    /* Step 1 */

    .ved343-content .pzn-title {
    	font-family: ProximaNova, 'Helvetica Neue', Helvetica, Arial, sans-serif;
    	font-size: 32px;
    	font-weight: bold;
    	color: #292d2f;
    	margin: 0;
    	margin-bottom: 40px;
        padding: 0 10px;
    }
    /* 1-5 Stars */

    .rating-wrap.rate-stars {
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* Stars Styling ---------------------------------------------------------- */
    /*shows the stars side by side, centered, and in reverse order than the HMTL*/
    .step1 .rating-wrapper {
        display: flex;
        flex-direction: row-reverse;
        justify-content: center;
        padding: 0 20px;
    }

    /*hides the radio buttons*/
    .step1 .rating-wrapper > input{ 
        display:none;
    }

    /*style the empty stars, sets position:relative as base for pseudo-elements*/
    .step1 .rating-wrapper > label {
        position: relative;
        width: 60px;
        font-size: 45px;
        color: #B80000;
        cursor: pointer;
    }

    /* sets filled star pseudo-elements */
    .step1 .rating-wrapper > label::before{ 
        content: "\2605";
        position: absolute;
        opacity: 0;
    }
    /*overlays a filled start character to the hovered element and all previous siblings*/
    .step1 .rating-wrapper > label:hover:before,
    .step1 .rating-wrapper > label:hover ~ label:before {
        opacity: 1 !important;
    }

    /*overlays a filled start character on the selected element and all previous siblings*/
    .step1 .rating-wrapper > input:checked ~ label:before{
        opacity:1;
    }

    /*when an element is selected and pointer re-enters the rating container, selected rate and siblings get semi transparent, as reminder of current selection*/
    .step1 .rating-wrapper:hover > input:checked ~ label:before{ 
        opacity: 0.4; 
    }

    /* Step 2 */
    .ved343-content .step2 .pzn-title {
    	margin-bottom: 16px;
    }
    .response-btns *,
    .response-btns  {
        margin: 0;
        padding: 0;
        font-size: 0;
        box-sizing: border-box;
    }
    .response-btns  {
        margin-bottom: 24px;
    }
    .response-btns > button {
        display: inline-block;
        width: fit-content;
        font-size: 16px;
        border: 1px solid #3e4f58;
        color: #3e4f58;
        padding: 8px 16px;
        border-radius: 20px;
        margin: 6px;
        line-height: 1;
    }
    .response-btns > button:hover {
        background-color: #e10a0a;
        background-color: rgba(225, 10, 10, 0.2);
        border-color: #e10a0a;
        color:#B80000;
    }
    .response-btns > button.btn-active {
        background-color: #B80000;
        border-color: #FFF;
        color: #FFF;
    }
    .step2 .submit-btn {
    	color: #fff;
    	background-color: #e10a0a;
    	padding: 14px 40px;
    	width: auto;
    	border-left: none;
    	border-radius: 4px;
    	border-width: 0px;
    	font-size: 14px;
    	font-weight: 700;
    	display: inline-block;
    	text-transform: uppercase;
    	text-align: center;
        margin-bottom: 16px;
        line-height: 1;
    }
    .step2 .submit-btn:hover {
        padding: 14px 40px;
        background-color: #b00808;
    }
    .step2-back,
    .step3-close {
    	text-decoration: underline;
    	display: block;
    	width: fit-content;
    	margin: 0 auto;
    	text-align: center;
    	padding: 5px;
        cursor: pointer;
        line-height: 1;
    }



    </style>

    <!-- HTML ========================================================================== -->
    <div class="ved343-main" id="dytmpl-${dyVariationId}">
        <div class="tysurvey-top"><img alt="Virgin Experience Days" class="pzn-ved-logo" src="https://ved.virgin.authxlab.com/_common/img/logos/ved--reversed.png?v=202109231430"></div>
        <div class="ved343-content step1 content_${dyVariationId}">
            <div class="step1">
                <div class="pzn-title title_${dyVariationId}">
                    ${Survey Step 1 Question}
                </div>
                <div class="rating-wrap rate-stars">
                    <span class="small-txt">${Low Stars Label}</span>
                    <div class="rating-wrapper">
                        <!--elements are in reversed order, to allow "previous sibling selectors" in CSS-->
                        <input action="mentionme"  type="radio" name="rating" value="5" id="5"><label for="5">☆</label>
                        <input action="mentionme"  type="radio" name="rating" value="4" id="4"><label for="4">☆</label>
                        <input action="step2" type="radio" name="rating" value="3" id="3"><label for="3">☆</label>
                        <input action="step2" type="radio" name="rating" value="2" id="2"><label for="2">☆</label>
                        <input action="step2" type="radio" name="rating" value="1" id="1"><label for="1">☆</label>
                      </div>
                    <span class="small-txt">${High Stars Label}</span>
                </div>
            </div>
            <div class="step2">
                <div class="pzn-title">${Survey Step 2 Question}</div>
                <div class="response-btns"></div>
                <button action="step3" class="submit-btn button_${dyVariationId}">${Submit Button Text}</button>
                <button action="step1" class="small-txt step2-back">${Step 2 Back Button}</button>
            </div>
            <div class="step3">
                <div class="pzn-title">${Step 3 Thank You Message}</div>
                <button action="close" class="small-txt step3-close">${Step 3 Close Button}</button>
            </div>
        </div>
    </div>
    
    <script>

    // SCRIPT ==========================================================================
    // All main variables
    let contentWrap = document.querySelector('.ved343-content'),
        modalClose = document.querySelector('.dy-lb-close'),
        localStorageAtt = 'VEDTYSurvey',
        SurveyCategory = 'DY thank you survey',
        secClasses = ['step1','step2','step3'],
        navElements = document.querySelectorAll('.step2-back, .step2 > .submit-btn, .rating-wrapper input, .step3-close'),
        step1Stars = document.querySelectorAll('.rating-wrapper input'),
        step2wordsWrap = document.querySelector('.response-btns'),
        step2words = `${Words}`,
        visSelection = {
            rating: '',
            feedback: [],
            purchase: 0
        }

    // Split / Clean words and convert string to array
    step2words = step2words.replace(/(\r\n|\n|\r)/gm,"").split(',');

    // check local storage for survey
    if (window.localStorage.hasOwnProperty(localStorageAtt)){
        console.log('LOCAL STORAGE: '+window.localStorage[localStorageAtt]);
    }

    // Storing revenue amount
    for (var i=0; i<dataLayer.length; i++){ 
        if (dataLayer[i].hasOwnProperty('ecommerce')){
            if (dataLayer[i].ecommerce.hasOwnProperty('purchase')){
                if (dataLayer[i].ecommerce.purchase.hasOwnProperty('actionField')){
                    if (dataLayer[i].ecommerce.purchase.actionField.hasOwnProperty('revenue')){
                        console.log(parseFloat(dataLayer[i].ecommerce.purchase.actionField.revenue));
                        visSelection.purchase = parseFloat(dataLayer[i].ecommerce.purchase.actionField.revenue);
                    }
                }
            }
        }
    }

    // Click / Step Control
    function stepJourney(action){
        // Check clicked element
        if (action.getAttribute('action').indexOf('mentionme') > -1){ // 4/5 stars clicked
            visSelection.rating = action.getAttribute('value')+' stars'; // Store star rating
            visSelection.feedback = ['mentionme'] // Mention me feedback
            tracking();
        } else if (action.getAttribute('action').indexOf('close') > -1){ // Step3 close button
            modalClose.click();
        } else {
            // Check previous class before switch
            if (action.hasAttribute('value')){
                step2Func(action);
            } else if (action.classList.contains('submit-btn')){
                tracking(); 
            }

            // Switch Step classes 
            contentWrap.classList.remove(...secClasses);
            contentWrap.classList.add(action.getAttribute('action'));
        }
    };

    // Eventlistner on CTAs
    navElements.forEach(function(elem) {
        elem.addEventListener('click', function() {
            stepJourney(elem); // Nav function
            console.log(elem);
        });
    });

    function tracking(){
        localStorage.setItem(localStorageAtt, JSON.stringify(visSelection)); // Storing in localstorage
        // Sending data to GA
        visSelection.feedback.forEach(function(word) {
            // dyHelper.sendToGA(SurveyCategory,visSelection.rating,word); Tracking
            console.log(visSelection);
        });
    }

    // Section 2 functions
    function step2Func(data) {
                    
        step2wordsWrap.innerHTML = ''; // Clear step 2 word buttons
        visSelection.rating = data.getAttribute('value')+' stars'; // Store star rating
        visSelection.feedback = []; // Clear feedback
     
        // Insert new buttons
        step2words.forEach(function(elem) {
            step2wordsWrap.insertAdjacentHTML('beforeend', '<button>'+elem+'</button>'); 
        });

        // Add event to word buttons
        document.querySelectorAll('.response-btns button').forEach(function(elem) {
            elem.addEventListener('click', function() {
                if (visSelection.feedback.includes(elem.innerText) &&  elem.classList.contains('btn-active')){
                    visSelection.feedback.splice(visSelection.feedback.indexOf(elem.innerText), 1); // Store button text
                    elem.classList.remove('btn-active'); // Add class to selected button
                } else {
                    visSelection.feedback.push(elem.innerText); // Store button text
                    elem.classList.add('btn-active'); // Add class to selected button
                }
            });
        });
    }
    </script>

      <!-- 
        - var dlProdInfo = google_tag_manager['GTM-53FL7B7'].dataLayer.get('ecommerce.detail.products');
        - smooth transitions
       -->
